計量経済の基本的な分析の流れ
1.仮説の設定

2.実証モデルの設定
→重回帰分析なのか、時系列分析なのかなど

3.データの選定
サンプルサイズとサンプル数
https://ai-trend.jp/basic-study/basic/samplesize/

4.予備的分析
基本統計量を確認する（平均・標準偏差など）
最大値や最小値などを確認して外れ値がないかなどを確認する。（箱ひげ図）
標準偏差でバラつきすぎていないのかを確認する。
散布図を確認して、相関などを確認する。


5.パラメータの推定
b0 や b1 などを求める。
標準誤差
→パラメータの推定誤差（誤差が大きいと推定パラメータの推定値もよくない。　p値がよくなくなる。）
→標準誤差が大きくて推定パラメータの値が０を含みそうとなった場合は、その推定は意味がなさそう。

6.仮設検定
パラメータの推定値が0になるかどうかを仮説検定する。
t値 = パラメータ(b0,b1など)/標準誤差
t値が2以上とかであれば、標準誤差はパラメータが 0 になる可能性は低いということになる。
→結局はp値を使用して確認すれば問題ない。

7.予測する
実際にパラメータが0にならなさそうであれば、それをもとに所得100万の人がどのくらい年間消費にお金を使うのか予測していく。
##################
解釈に関して

# 回帰分析のデータの解釈
・どの説明変数が被説明変数に影響を与えているのか？
→この説明変数が上がると、この被説明変数がどれだけ上がる(下がる)みたいな。
→統計的に優位（p値が優位水準を超えているものを確認する。）

・ダミー変数の解釈に関して
→説明変数から除外されているものを基準にして、それよりもどれぐらい被説明変数が大きい（小さい）かを解釈する。
→例えば、20代以下、30~50代、60代以上があったとして、回帰分析に（30~50代、60代以上）の説明変数を入れて回帰分析を行った場合。(被説明変数はlog(年収)とする)
→回帰係数の結果が次のような場合、30~50代:0.3、60代以上:0.4であったとき、20代に比べて30~50代は40%年収が高くなる。といった解釈になる。
→交差項を含んだものに関しては「実証分析のための計量経済学」を確認するように。


#################


★対応のない、対応のある
2つの集団（2群）の比較で、異なる集団について測定したデータは対応のないデータ、同じ集団について測定したデータは対応のあるデータという。
全員に介入して、変化を見たい場合→対応のある母平均の差の検定
一部と比較して変化を見たい場合→対応のない母平均の差の検定

★因果推論で回帰分析をする場合
回帰分析を使用してやる場合
→バイアスを取り除くには共変量（コントロール変数）を回帰分析に入れる。
→共変量が0の時、試作の効果がどうなってんのかを確認することができる。
→E[Y|X]だったのがE[Y|X,C]のように条件つけてみることができる。
→交差項（女性かつ高卒）を入れると相乗効果を確かめることができる。
→多重共線性があるか確認する方法→VIF 10 超えていたらマルチコが発生していると一般的には考えられている。
（マルチコが起きていると、係数が過大に評価されてしまう。）
→仮定を満たしているのかどうかを確認する方法
→https://note.com/osipp_econ/n/nb817891c576f
→https://note.com/osipp_econ/n/n26a1dc5c922d
<重要！>毎回ホワイト検定などで不均一分散かどうかを確認する必要がある。
基本的に仮定を満たしていないことが多いため。


・バイアスがあると（交絡のことを表している。）変数選択
効果が、過剰に推定されてしまう
→取り除くには、YとX(介入変数)どちらにも影響をあたえるものを入れるとよい。
→ようはバイアスがあると、その分の効果が含まれてしまう。（Xの係数の値に含まれる。）
→そのため、交絡因子は入れるべきだが、操作変数は回帰式に入れてはいけない。
→DAGを自分で作成すれば何を条件づけるか何を条件づけてはいけないかがわかるので便利

・多重共線性とは？？
本来は統計的に優位なものが優位ではなくなってしまう。
→説明変数同士の相関が高いとそうなる。
→逆行列が求めることができずに欲しい値が取れない。
→片方づつを説明変数に用いた推定を行い、それぞれの結果を考察する。

・ダミー変数（基準に置きたいものを除外するようにする。）
→ダミー変数は基本的に0,1で表されるため、それにより切片ダミーとも言われる。
→傾きダミー変数を使用したい場合、ダミー変数と説明変数の交差こうを使用するとできる。

#####################################################
中心極限定理のありがたさ
結論としては、平均値の分散がわかる。

######################################################
誤差項に関して

★BLUEの特性（BLUEだと以下の特性がある！）BLUEであるとこう言う性質を持っているよみたいなもの
・線形性：線形モデルの推定量
・不偏性：推定量の期待値が真の値に等しい（分散の期待値がゼロ）
・効率性：推定量の分散が最小である。（誤差項の共分散がゼロ）
・一致性：サンプルサイズを大きくすれば、推定量がある値に収束する。

★★BLUEを満たす仮定（３つ：ガウスマルコフの定理）
①誤差項の分散が均一であること（均一分散）
→確率を出すモデルの時などに満たさないことがある。
→満たせてなかったら、不均一分散を使用する！（ロバスト標準誤差）

②誤差間で相関がないこと（共分散ゼロ）
¬時系列データの時に満たさないことがある。
→対策としては、一般化最小二乗法を使用する

③誤差項と説明変数の間で相関がないこと（説明変数と独立）
→これが一番大事！これを満たしていないと一致性が失われる！
→欠落バイアス（説明変数に必要な変数が欠落している。）がある・同時決定バイアス・内生性バイアス（被説明変数も説明変数の決定要因になっている・逆の因果があったりなど。。）・・・この時は誤差項と相関をもつ


★残差分析を行う時はこちら
https://www.ritolab.com/posts/245#%E6%AE%8B%E5%B7%AE%E5%88%86%E6%9E%90
memo
誤差項のばらつきが均一出ない時は robust standard error(ロバスト標準誤差を使用するとよい。)

★不偏性のための4つの仮定
1.母集団分布において、確率変数の間には線形の関係がある。(y = b0 + b1・x + U)
2.母集団から標本サイズ n の無作為抽出になっている。
3.E[U|X]=0 説明変数と誤差項は平均独立
4.説明変数 X に変動がある。(全ての観測が同じではない)



★残差と誤差は違うので注意
<重要>
誤差項の推定値として残差を使用する。
→この残差を使用して誤差項の分散が均一なのかどうかとか、そういうのをみていく！
残差:回帰分析で求めた式で算出した予測値と真の値との差
誤差:真の回帰式と真の値との差
→https://bellcurve.jp/statistics/course/9704.html

######################################################
被説明変数が1,0のような2値のダミー変数で確率を返したい場合
二つの手法がある
・プロビットモデル: 標準正規分布の累積分布関数(最尤法で最適化する)
・ロジスティックモデル: ロジスティックモデルの累積分布関数

<注意>
プロビットモデルやロジスティックモデルで計算されて出てきた係数に関しては、
そのまま１あがったら何％増えるみたいに解釈することができない。
（あくまでも、プラス（もしくはマイナス）に影響を与えると言うことでしか解釈ができない）
→もし回帰分析みたいに１上がったら何％増えるかを知りたい場合は、新たに算出する必要がある。（多分ライブラリで算出できる。）


★最尤法
母集団が正規分布に従っていることを仮定している。
また、対数をとって対数尤度を最大化するようにしている。
→計算が楽になるから。

######################################################
★統計的な手法（ランダム化比較試験ができないときの対処）

・逆の因果関係がある場合（操作変数法・2段階最小二乗法）
X→Y かつ Y→Xでもある場合
もし、Y→Xの影響が大きかった場合はX→Yで回帰をしてXが正に優位であったとしてもY→Xの影響を反映しているからである。
また逆の因果関係がある中で回帰分析を行ったとしても、内生性バイアスがあるためBLUEではなくなる。
→誤差項にYの影響が入り、Xと誤差項で相関を持つため誤差項が独立でなくなる。（一致性がなくなる。）

差の差分析
操作変数法
回帰不連続
マッチング方法

・差と差の分析
介入前後で変化があったかどうかをみる。
介入群と対対照群の介入前と介入後の差を見て効果を推定する。(対応のあるt検定を行う。、回帰分析でも行うことができる。この時は交差項を使用する（実証計量経済のp199を確認）)
前提条件2つある
・介入群と対照群において広告を出す前の売上のトレンドが平行（広告を出す前の売上の傾きが介入群と対照群とで一緒っていう感じ！）
・介入後に売上に影響を与えるような別の変化が起きていない



・操作変数法（逆の因果関係があるときなどに使用することができる。）
内生性(誤差高と説明変数に相関がある。)がある場合でも一致推定のできる方法。
前提条件2つ
・操作変数は原因（X：説明変数）に影響するが、結果（Y：被説明変数）には直接影響しない。
・操作変数と結果の両方に影響を与えるような第4の変数が存在しない
手順：
① 説明変数を操作変数で回帰する（説明変数（X）を被説明変数、操作変数を説明変数にして予測する。）
→これを行うことで操作変数でXを説明することができるもののみが残るYの影響が取り除かれる。誤差項がなくなる。（詳しくは実証分析のための計量経済学P171）
② ①で予測した値を使用して被説明変数を回帰する。

・回帰不連続デザイン
前提条件
連続変数のカットオフ値の周辺で結果に影響を与えるような他のイベントが起きていない

・傾向スコアマッチング
前提条件2つ
・すべての共変量がデータとして存在している。
・共変量がすべて傾向スコアに使用されている